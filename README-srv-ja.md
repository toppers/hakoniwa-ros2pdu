# 📄 README - `generate_hako_service_msgs.py`

## 概要
このツールは、与えられたROSの`.srv`ファイルに基づいて、箱庭サービス実装に必要な`.msg`ファイルを生成します。  
`.srv`定義をパースし、箱庭メッセージ規約に従ったリクエスト、レスポンス、パケットメッセージファイルを出力します。

---

## 目的と前提

- 本ツールは、**既存のROS `.srv`ファイルを再利用して、箱庭サービス通信構造を簡単に構築する**ことを目的としています。
- **ROS IDL互換性**は、**`.srv`構造レベルで保証**されます：
  - リクエストおよびレスポンスのフィールド型・構造は、ROS `.srv` IDL仕様に準拠します。
  - ただし、**ROSサービス通信プロトコルとの実行時互換性は保証しません**。
- 生成される`.msg`ファイルは、**箱庭サービスRPC通信専用**であり、ROSノード間の直接通信には使用できません。

---

## 想定ユースケース

- 既存のROS `.srv`ファイルを持っている開発者が、
- 本ツールを使って**自動的に箱庭サービス用の`.msg`ファイル群を生成**し、
- **箱庭シミュレーション環境内でRPC通信の実装・シミュレーションを簡単に行える**ようになります。
- これにより、**既存のROSサービス設計資産を無駄なく箱庭エコシステムに適応**できるようになります。

---

## 使い方

```bash
python generate_hako_service_msgs.py <srvファイルパス> --out <出力ベースディレクトリ>
```

### 実行例

```bash
python generate_hako_service_msgs.py hako_srv/AddTwoInts.srv --out dest/
```

生成されるディレクトリ構成は以下の通りです：

```
dest/
└── hako_srv_msgs/
    ├── AddTwoIntsRequest.msg
    ├── AddTwoIntsResponse.msg
    ├── AddTwoIntsRequestPacket.msg
    └── AddTwoIntsResponsePacket.msg
```

---

## 詳細仕様

- 入力は標準的なROS `.srv`ファイルです。
- `.srv`ファイルの**親ディレクトリ名**を**サービスパッケージ名**（例：`hako_srv`）とみなします。
- メッセージパッケージ名は、**サービスパッケージ名に`_msgs`を付加**して生成されます（例：`hako_srv_msgs`）。
- 指定された出力ベースディレクトリの下に、対応するメッセージパッケージディレクトリが作成され、そこにファイルが出力されます。
- 生成されるファイルは以下の4種類です：
  - `<サービス名>Request.msg`
  - `<サービス名>Response.msg`
  - `<サービス名>RequestPacket.msg`
  - `<サービス名>ResponsePacket.msg`
- `ServiceRequestHeader.msg`および`ServiceResponseHeader.msg`は本ツールでは生成しません（箱庭標準で提供されています）。

---

## パースルール

- `#`で始まる行はコメント行として無視します。
- 空行は無視します。
- フィールド定義は`<型> <名前>`の形式で記述する必要があります。
- **定数定義**（例：`int8 FOO=1`）は無視し、`.msg`ファイルには含めません。
- リクエストまたはレスポンスにデータフィールドが1つも存在しない場合、エラーとなります。

---

## フィールド型表記ルール

- プリミティブ型（`int32`、`string`など）はそのまま記述します。
- **同一メッセージパッケージ内の型**はパッケージ名を省略します。
- **異なるパッケージの型**（例：`std_msgs/Header`）は**パッケージ名付きのフル修飾型**で記述します。
- 配列にも対応します：
  - 可変長配列：`type[] フィールド名`
  - 固定長配列：`type[N] フィールド名`

---

## エラー処理

- リクエストフィールドまたはレスポンスフィールドが存在しない場合、エラーを出して処理を中断します。
- 出力先ディレクトリおよびサブディレクトリは存在しない場合自動的に作成されます。
- 既存の`.msg`ファイルがある場合は、警告なしで上書きします。

---

## 注意事項

- 本ツールはROSの**IDL構造互換性のみ**を保証します。
- ROSサービスノードとの**直接通信互換性は保証しません**。
- 生成される`.msg`ファイルは**箱庭サービスAPI専用**です。

---
